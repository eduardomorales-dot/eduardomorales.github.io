<!doctype html> 
<html>
  <head>
    <meta charset="utf-8">
    <title>Rotate Image to Mouse</title>
    <style>
      body { 
        margin: 0;
        background: url("Herta2.jpg") no-repeat center center fixed; /* imagen de fondo */
        background-size: cover; /* que cubra toda la ventana el fondo */
        color: #fff; 
        font-family: sans-serif; 
        text-align: center; 
      }
      canvas {
        border: 1px solid #444;
        background: rgba(34,34,34,0.85); 
        display: block;
        margin: 1rem auto;
      }
      button {
        margin-top: 10px;
        padding: 8px 12px;
        border-radius: 6px;
        border: none;
        background: #444;
        color: #fff;
        cursor: pointer;
      }
      button:hover { background: #666; }
    </style>
  </head>
  <body>
    <h2>Kuru Kuru the Herta</h2>
    <canvas id="canvas" width="500" height="500"></canvas>
    <aside>Move the mouse over the canvas</aside>

    <button id="resetBtn" type="button">Reset that Herta Kuru kuru (R)</button>

    <script>
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");

      // Imagen
      const img = new Image();
      img.src = "Herta.png";

      // Objeto
      const sprite = {
        x: canvas.width / 2,
        y: canvas.height / 2,
        rotation: 0,
        prevRotation: 0
      };

      // Audio
      const audio = new Audio("kuru-kuru-kururing.mp3");
      audio.loop = false; // sonará cada vez que gire, no continuo infinito

      // Puntero
      const mouse = { x: canvas.width/2, y: canvas.height/2 };
      canvas.addEventListener("mousemove", e => {
        const rect = canvas.getBoundingClientRect();
        mouse.x = e.clientX - rect.left;
        mouse.y = e.clientY - rect.top;
      });

      function resetPosition() {
        sprite.x = canvas.width / 2;
        sprite.y = canvas.height / 2;
        mouse.x = sprite.x;
        mouse.y = sprite.y;
      }

      document.getElementById("resetBtn").addEventListener("click", resetPosition);
      window.addEventListener("keydown", (e) => {
        if (e.key === 'r' || e.key === 'R') resetPosition();
      });

      function loop() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        const dx = mouse.x - sprite.x;
        const dy = mouse.y - sprite.y;
        sprite.rotation = Math.atan2(dy, dx);

        // Si la rotación cambió desde el frame anterior → reproducir sonido
        if (sprite.rotation !== sprite.prevRotation) {
          audio.currentTime = 0; // reinicia desde el inicio
          audio.play();
        }
        sprite.prevRotation = sprite.rotation;

        if (img.complete) {
          ctx.save();
          ctx.translate(sprite.x, sprite.y);
          ctx.rotate(sprite.rotation);
          ctx.drawImage(img, -img.width/2, -img.height/2);
          ctx.restore();
        }

        requestAnimationFrame(loop);
      }

      img.onload = loop;
    </script>
  </body>
</html>